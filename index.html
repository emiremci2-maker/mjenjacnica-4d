
<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Mjenjačnica Infinity - 4D</title>
    
    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/examples/js/controls/OrbitControls.js"></script>
    <!-- GSAP -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { overflow:hidden; background:#87CEEB; font-family:Arial; }
        #container { position:fixed; top:0; left:0; width:100%; height:100%; }
        #info, #time-display, .button {
            position:absolute; color:white; z-index:100; padding:10px 15px; border-radius:8px; font-size:14px;
        }
        #info { top:20px; left:20px; background:rgba(0,0,0,0.7); max-width:300px; }
        #time-display { bottom:20px; right:20px; background:rgba(255,0,0,0.8); font-size:18px; }
        .button { bottom:20px; left:20px; background:#ff0000; border:none; font-weight:bold; cursor:pointer; }
        .button:hover { background:#cc0000; }
    </style>
</head>
<body>
    <div id="container"></div>

    <div id="info">
        <h2>MJENJAČNICA INFINITY</h2>
        <p>Radno vrijeme: 08:00 - 20:00</p>
        <p>Valute • Western Union • Kripto</p>
        <p><em>4D: 3D + vrijeme</em></p>
    </div>

    <div id="time-display">Vrijeme: 08:00</div>
    <button class="button" id="resetBtn">Reset</button>

    <script>
        // --- SIGURNA INICIJALIZACIJA ---
        const container = document.getElementById('container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 5;
        controls.maxDistance = 20;

        camera.position.set(8, 6, 10);
        controls.update();

        // --- SVJETLO ---
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);
        const sunLight = new THREE.DirectionalLight(0xffffff, 1);
        sunLight.position.set(10, 20, 10);
        sunLight.castShadow = true;
        sunLight.shadow.mapSize.width = 2048;
        sunLight.shadow.mapSize.height = 2048;
        scene.add(sunLight);

        // --- POD ---
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(30, 30),
            new THREE.MeshStandardMaterial({ color: 0x555555, roughness: 0.9 })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // --- MJENJAČNICA ---
        const exchange = new THREE.Group();

        const kiosk = new THREE.Mesh(
            new THREE.BoxGeometry(4.5, 3, 2.5),
            new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.8, roughness: 0.2 })
        );
        kiosk.castShadow = true;
        kiosk.receiveShadow = true;
        exchange.add(kiosk);

        const roof = new THREE.Mesh(
            new THREE.BoxGeometry(5.1, 0.3, 3.1),
            new THREE.MeshStandardMaterial({ color: 0xff0000 })
        );
        roof.position.y = 1.65;
        roof.castShadow = true;
        exchange.add(roof);

        // Natpis
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1024; canvas.height = 256;
        ctx.fillStyle = '#ff0000'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.font = 'bold 100px Arial'; ctx.fillStyle = 'white'; ctx.textAlign = 'center';
        ctx.fillText('MJENJAČNICA - INFINITY', canvas.width/2, 140);

        const signTex = new THREE.CanvasTexture(canvas);
        const sign = new THREE.Mesh(
            new THREE.PlaneGeometry(5, 1.25),
            new THREE.MeshBasicMaterial({ map: signTex })
        );
        sign.position.set(0, 2.1, 1.26);
        exchange.add(sign);

        // Prozor
        const windowMesh = new THREE.Mesh(
            new THREE.PlaneGeometry(3.5, 1.8),
            new THREE.MeshPhysicalMaterial({ color: 0x88ccff, transparent: true, opacity: 0.7, transmission: 0.9 })
        );
        windowMesh.position.set(0, 0.3, 1.26);
        exchange.add(windowMesh);

        // Roleta
        const shutter = new THREE.Mesh(
            new THREE.BoxGeometry(3.6, 0.1, 0.1),
            new THREE.MeshStandardMaterial({ color: 0xaaaaaa })
        );
        shutter.position.set(0, 1.5, 1.31);
        shutter.name = 'shutter';
        exchange.add(shutter);

        // Baloni
        for (let i = 0; i < 20; i++) {
            const ball = new THREE.Mesh(
                new THREE.SphereGeometry(0.25),
                new THREE.MeshStandardMaterial({ color: i % 2 ? 0xff0000 : 0xffffff })
            );
            ball.position.set(-2.8, -1.5 + i * 0.5, 0);
            ball.castShadow = true;
            exchange.add(ball);
        }

        exchange.position.y = 1.5;
        scene.add(exchange);

        // --- 4D: VRIJEME ---
        let time = 8 * 60;
        const timeDisplay = document.getElementById('time-display');

        function updateTime() {
            time = (time + 0.5) % (24 * 60);
            const h = String(Math.floor(time / 60)).padStart(2, '0');
            const m = String(Math.floor(time % 60)).padStart(2, '0');
            timeDisplay.textContent = `Vrijeme: ${h}:${m}`;

            const t = time / (24 * 60);
            const angle = t * Math.PI * 2 - Math.PI / 2;
            sunLight.position.set(
                Math.cos(angle) * 20,
                Math.sin(angle) * 20 + 5,
                Math.sin(angle * 0.7) * 10
            );

            const isDay = time >= 6*60 && time < 18*60;
            sunLight.intensity = isDay ? 1 : 0.3;
            ambientLight.intensity = isDay ? 0.6 : 0.2;
            renderer.setClearColor(isDay ? 0x87CEEB : 0x111133);

            const open = time >= 8*60 && time <= 20*60;
            gsap.to(shutter.position, { y: open ? 2.4 : 1.5, duration: 2 });
        }

        // --- RESIZE ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- RESET ---
        document.getElementById('resetBtn').onclick = () => {
            camera.position.set(8, 6, 10);
            controls.reset();
        };

        // --- LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            updateTime();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
